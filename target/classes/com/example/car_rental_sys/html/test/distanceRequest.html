<!-- 从地理坐标计算距离 -->


<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <Style>
        html,
        body {
            height: 100%;
            margin: 0;
            padding: 0;
        }

        #container {
            height: 100%;
            display: flex;
        }

        #sidebar {
            flex-basis: 15rem;
            flex-grow: 1;
            padding: 1rem;
            max-width: 30rem;
            height: 100%;
            box-sizing: border-box;
            overflow: auto;
        }

        #map {
            flex-basis: 0;
            flex-grow: 4;
            height: 100%;
        }

        #sidebar {
            flex-direction: column;
        }
    </Style>
</head>

<body>
    <div id="container">
        <div id="map"></div>
        <div id="sidebar">
            <h3 style="flex-grow: 0">Request</h3>
            <pre style="flex-grow: 1" id="request"></pre>
            <h3 style="flex-grow: 0">Response</h3>
            <pre style="flex-grow: 1" id="response"></pre>
        </div>
    </div>
    <Button onclick="calculateDistance1()">Click me</Button>
    <script>
        //3.063831638195926 101.69940948486328
        //3.0527096567339838 101.7011089752461
        function calculateDistance1() {
            calculateDistance([3.063831638195926, 101.69940948486328], [3.0527096567339838, 101.7011089752461])
        }

        function calculateDistance(origins, destinations) {
            originsLat = origins[0];
            originsLng = origins[1];
            destinationsLat = destinations[0];
            destinationsLng = destinations[1];

            url = "https://maps.googleapis.com/maps/api/distancematrix/json?"

            key = "AIzaSyBam-tEfHfTu0QbI4J3H2HzX85JKvXDEig"

            requestUrl = `${url}origins=${originsLat}%2C${originsLng}&destinations=${destinationsLat}%2C${destinationsLng}&key=${key}`
            console.warn(requestUrl)

            fetch(requestUrl)
                .then(data => {
                    return data.json();
                })
                .then(post => {
                    console.log(post.title);
                });
        }

        function demo() {
            var origin1 = new google.maps.LatLng(3.063831638195926, 101.69940948486328);
            var origin2 = 'Greenwich, England';
            var destinationA = 'Stockholm, Sweden';
            var destinationB = new google.maps.LatLng(3.0527096567339838, 101.7011089752461);

            var service = new google.maps.DistanceMatrixService();
            service.getDistanceMatrix(
                {
                    origins: [origin1],
                    destinations: [destinationB],
                    travelMode: 'DRIVING',
                    transitOptions: TransitOptions,
                    drivingOptions: DrivingOptions,
                    unitSystem: UnitSystem,
                    avoidHighways: Boolean,
                    avoidTolls: Boolean,
                }, callback);

            function callback(response, status) {
                // See Parsing the Results for
                // the basics of a callback function.
            }
        }
    </script>
    <script>
        /**
     * @license
     * Copyright 2019 Google LLC. All Rights Reserved.
     * SPDX-License-Identifier: Apache-2.0
     */
        // @ts-nocheck TODO remove when fixed
        function initMap() {
            const bounds = new google.maps.LatLngBounds();
            const markersArray = [];
            const map = new google.maps.Map(document.getElementById("map"), {
                center: {
                    lat: 55.53,
                    lng: 9.4
                },
                zoom: 10,
            });
            // initialize services
            const geocoder = new google.maps.Geocoder();
            const service = new google.maps.DistanceMatrixService();
            // build request
            const origin1 = {
                lat: 3.063831638195926,
                lng: 101.69940948486328
            };
            const destinationB = {
                lat: 3.0527096567339838,
                lng: 101.7011089752461
            };
            const request = {
                origins: [origin1],
                destinations: [destinationB],
                travelMode: google.maps.TravelMode.DRIVING,
                unitSystem: google.maps.UnitSystem.METRIC,
                avoidHighways: false,
                avoidTolls: false,
            };

            // put request on page
            document.getElementById("request").innerText = JSON.stringify(
                request,
                null,
                2
            );
            // get distance matrix response
            service.getDistanceMatrix(request).then((response) => {
                // show request on the console
                let resData = JSON.stringify(
                    response,
                    null,
                    2
                );
                console.log(resData);


                // put response
                document.getElementById("response").innerText = JSON.stringify(
                    response,
                    null,
                    2
                );


                // show on map
                const originList = response.originAddresses;
                const destinationList = response.destinationAddresses;

                deleteMarkers(markersArray);

                const showGeocodedAddressOnMap = (asDestination) => {
                    const handler = ({
                        results
                    }) => {
                        map.fitBounds(bounds.extend(results[0].geometry.location));
                        markersArray.push(
                            new google.maps.Marker({
                                map,
                                position: results[0].geometry.location,
                                label: asDestination ? "D" : "O",
                            })
                        );
                    };
                    return handler;
                };

                for (let i = 0; i < originList.length; i++) {
                    const results = response.rows[i].elements;

                    geocoder
                        .geocode({
                            address: originList[i]
                        })
                        .then(showGeocodedAddressOnMap(false));

                    for (let j = 0; j < results.length; j++) {
                        geocoder
                            .geocode({
                                address: destinationList[j]
                            })
                            .then(showGeocodedAddressOnMap(true));
                    }
                }
            });
        }

        function deleteMarkers(markersArray) {
            for (let i = 0; i < markersArray.length; i++) {
                markersArray[i].setMap(null);
            }

            markersArray = [];
        }

        window.initMap = initMap;
    </script>

    <script
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBam-tEfHfTu0QbI4J3H2HzX85JKvXDEig&callback=initMap&v=weekly"
        defer></script>
</body>

</html>